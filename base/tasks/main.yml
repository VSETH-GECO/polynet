---
  - name: Setup hostname
    cisco.ios.ios_config:
        lines:
          - hostname {{ inventory_hostname }}

  - name: Enable snmp
    cisco.ios.ios_config:
        lines:
          - snmp-server community {{ snmp_ro_string }} RO

  - name: Disable vtp
    cisco.ios.ios_config:
      lines:
        - vtp mode off

  - name: Setup ntp
    cisco.ios.ios_config:
      lines:
        - ntp server {{ ntp_server }}

  - name: Setup global vlans
    cisco.ios.ios_config:
        lines:
          - name {{ item.value.description}}
        parents:  vlan {{ item.value.number }}
    with_dict: "{{ global_vlans }}"

  - name: Setup mgmnt VLAN Interface
    cisco.ios.ios_config:
      lines:
        - description mgmnt vlan
      parents: interface Vlan1

  - name: Enable AAA for Radius
    when: polynet_base_enable_radius
    cisco.ios.ios_config:
      lines:
        - aaa new-model
        - aaa authentication dot1x default group radius
        - aaa authorization network default group radius
        - aaa authorization exec default if-authenticated
        - aaa accounting network default start-stop group radius
        - aaa accounting dot1x default start-stop group radius
        - aaa session-id common
        - dot1x system-auth-control
    tags:
      - radius

  - name: Setup RADIUS servers
    when: polynet_base_enable_radius
    cisco.ios.ios_config:
      lines:
        - address ipv4 {{ item.ip }} auth-port 1812 acct-port 1813
        - key {{ item.secret }}
      parents: radius server {{ item.name }}
    with_items: "{{ polynet_base_radius_servers }}"
    tags:
      - radius

  - name: Setup RADIUS settings
    when: polynet_base_enable_radius
    cisco.ios.ios_config:
      lines:
        - radius-server vsa send authentication
        - radius-server retransmit 2
        - radius-server timeout 3
        - radius-server dead-criteria time 10
        - radius-server deadtime 2
        - radius-server load-balance method least-outstanding
        - radius-server retry method reorder
    tags:
      - radius

  # This will always be changed for some reason...
  - name: Setup RADIUS CoA server clients
    when: polynet_base_enable_radius_coa
    cisco.ios.ios_config:
      lines:
        - client {{ item.ip }} server-key {{ item.secret }}
      parents: aaa server radius dynamic-author
    with_items: "{{ polynet_base_radius_coa_clients }}"
    tags:
      - radius

  - name: Setup RADIUS CoA server settings
    when: polynet_base_enable_radius_coa
    cisco.ios.ios_config:
      lines:
        - port 3799
      parents: aaa server radius dynamic-author
    tags:
      - radius

  - name: Write configuration
    when: polynet_persist_config
    ios_command:
      commands:
        - write
